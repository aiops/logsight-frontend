<p-card>
  <p-table
    #overviewTable
    [value]="items"
    [(selection)]="selectedItems"
    dataKey="incidentId"
    [paginator]="true"
    [rowsPerPageOptions]="rowsPerPageOptions"
    [rows]="rowsPerPageOptions[0]"
    sortMode="multiple">
    <ng-template pTemplate="caption">
      <div class="row">
        <div class="col-1">
          <p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>
          <button
            pButton
            type="button"
            label="Delete"
            class="p-button-danger"
            icon="pi pi-trash"
            [disabled]="selectedItems.length === 0"
            (click)="deleteItems()">
          </button>
        </div>
        <div class="col">
          <div class="row float-right">
            <div *ngIf="endDateTime == 'now'" class="col my-auto">
              <p class="time-text my-auto">{{startDateTime.split('-')[1]}} ago</p>
            </div>
            <div *ngIf="endDateTime != 'now'" class="col my-auto">
              <p class="time-text my-auto"> {{startDateTime |date:'medium'}}
                <br>
                {{endDateTime |date:'medium'}} </p>
            </div>
            <div class="col">
              <predefined-times (deletePredefinedTime)="onDeletePredefinedTime($event)"
                                (selectPredefinedTime)="onSelectPredefinedTime($event)"
                                [predefinedTimes]="predefinedTimes">
              </predefined-times>
            </div>
            <div class="col-1">
              <p-overlayPanel #op [dismissable]="false" [appendTo]="'body'">
                <ng-template pTemplate>
                  <elastic-custom-datepicker (savePredefinedTime)="onSavePredefinedTime($event)"
                                             (search)="onDateTimeSearch($event)">
                  </elastic-custom-datepicker>
                </ng-template>
              </p-overlayPanel>
              <button (click)="op.toggle($event)" pButton pRipple type="button"
                      icon="pi pi-calendar"
                      class="my-auto p-button-rounded"></button>
            </div>
          </div>
        </div>
      </div>


    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3%;" rowspan="2">
          <p-tableHeaderCheckbox name="incidents"></p-tableHeaderCheckbox>
        </th>
        <th style="width: 10%" [pSortableColumn]="'timestampStart'">Date
          <p-sortIcon [field]="'timestampStart'"></p-sortIcon>
        </th>
        <th style="width: 10%" [pSortableColumn]="'incidentId'">Incident ID
          <p-sortIcon [field]="'incidentId'"></p-sortIcon>
        </th>
        <th style="max-width: 15%;" [pSortableColumn]="'message'">Description
          <p-sortIcon [field]="'message'"></p-sortIcon>
        </th>
        <th style="width: 10%">Tags</th>
        <th style="width: 5%" [pSortableColumn]="'risk'">Risk
          <p-sortIcon [field]="'risk'"></p-sortIcon>
        </th>
        <th style="width: 8%" [pSortableColumn]="'severity'">Severity
          <p-sortIcon [field]="'severity'"></p-sortIcon>
        </th>
         <th style="width: 9%" [pSortableColumn]="'added_states'">Added states
          <p-sortIcon [field]="'added_states'"></p-sortIcon>
        </th>
        <th style="width: 10%" [pSortableColumn]="'status'">Status
          <p-sortIcon [field]="'status'"></p-sortIcon>
        </th>
        <th style="width: 10%" class="text-center"></th>
      </tr>
      <tr>
        <th>
        </th>
        <th>
          <input
            pInputText
            type="text"
            (input)="filterByIncidentId($event)"
            placeholder="Search"
            class="p-column-filter">
        </th>
        <th>
          <input
            pInputText
            type="text"
            (input)="filterByMessage($event)"
            placeholder="Search"
            class="p-column-filter">
        </th>
        <th>
          <p-multiSelect placeholder="Filter" [options]="tagOptions" (onChange)="filterByTags($event)"
                         [filter]="true"></p-multiSelect>
        </th>
        <th class="text-center">
          <p>{{riskSliderValues[0]}} to {{riskSliderValues[1]}}</p>
          <p-slider [ngModel]="riskSlider" [min]="0" max="100" [range]="true"
                    (onSlideEnd)="filterByRisk($event)"></p-slider>
        </th>
        <th>
          <p-dropdown
            [options]="severityOptions"
            (onChange)="filterBySeverity($event)"
            styleClass="p-column-filter"
            placeholder="Select"
            [showClear]="true">
            <ng-template let-option pTemplate="item">
              <span [class]="'severity-badge severity-' + option.label">{{option.label}}</span>
            </ng-template>
          </p-dropdown>
        </th>
        <th>
        </th>
        <th>
          <p-dropdown
            [options]="statusOptions"
            (onChange)="filterByStatus($event)"
            styleClass="p-column-filter"
            placeholder="Select"
            [showClear]="true">
            <ng-template let-option pTemplate="item">
              <span>{{option.label}}</span>
            </ng-template>
          </p-dropdown>
        </th>
        <th>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>
          <p-checkbox name="incidents" [value]="item" [(ngModel)]="selectedItems"></p-checkbox>
        </td>
        <td>{{item.timestamp | date: 'MMM d, y, hh:mm:ss'}}</td>
        <td><p pTooltip="{{item.incidentId}}" tooltipPosition="top">{{item.incidentId.slice(0, 7)}}</p></td>
        <td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden">{{item.message.template}}</td>
        <td>
          <nb-tag-list>
            <nb-tag *ngFor="let tagKey of item.tagKeys" [text]="tagKey"
                    appearance="outline"
                    status="primary" style="text-transform: none"></nb-tag>
          </nb-tag-list>
        </td>

        <td>
          {{ item.risk }} %
        </td>
        <td>
          <span [class]="'severity-badge severity-' + Severity[item.severity]">{{ Severity[item.severity] }}</span>
        </td>
         <td>
          {{ item.countAddedState }}
        </td>
        <td>
          <p-dropdown
            [options]="statusOptions"
            [ngModel]="{ value: item.status }"
            (onChange)="statusChanged($event, item)"
            dataKey="value"
            optionLabel="label">
          </p-dropdown>
        </td>
        <td class="text-center">
          <button (click)="viewInsights(item.incidentId)" pButton type="button" label="View insights"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>


<!--<ng-template #dateTimePicker>-->
<!--  <elastic-custom-datepicker (savePredefinedTime)="onSavePredefinedTime($event)"-->
<!--                             (search)="onDateTimeSearch($event)">-->
<!--  </elastic-custom-datepicker>-->
<!--</ng-template>-->
