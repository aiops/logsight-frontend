<div class="row" style="padding-left: 5%;padding-right: 5%">
  <div class="col-md-4">
    <nb-select (selectedChange)="applicationSelected($event)" [(selected)]="this.applicationId"
               class="period-select col-md-2 pl-3"
               placeholder="Select application">
      <nb-option [value]="0">All</nb-option>
      <nb-option *ngFor="let app of applications" [nbSort]="app.name" [value]="app.id">
        {{ app.name }}
      </nb-option>
    </nb-select>

    <nb-icon icon="info-outline"
             nbButton
             nbTooltip="Select application" nbTooltipStatus="basic" status="basic"></nb-icon>
  </div>
  <div class="col-md-8 text-right">
    <div class="row" style="padding-right: 5%; display: flex; justify-content: flex-end; width: 100%">
      <predefined-times (deletePredefinedTime)="onDeletePredefinedTime($event)" (selectPredefinedTime)="onSelectPredefinedTime($event)"
                        [predefinedTimes]="predefinedTimes">

      </predefined-times>
      <button (click)="openPopover()" [nbPopover]="dateTimePicker" nbButton nbPopoverPlacement="bottom"
              nbPopoverTrigger="noop" shape="round" size="small"
              title="Select Date Range"><i class="fa fa-calendar"></i></button>
    </div>
  </div>
</div>
<hr noshade size="30" style="margin-left: 5%; margin-right: 5%; background-color: #4b4b4b">

<div style="padding-left: 5%;padding-right: 5%" tourAnchor="anchorIncidentsTab">
  <div *ngIf="tableData  && tableData.semanticCountAds.length > 0" tourAnchor="anchorCriticalAnomalies">
    <h6 style="font-weight: 600">Critical anomalies
      <nb-icon icon="info-outline"
               nbButton
               nbTooltip="Critical anomalies are most severe. It means that they are deviating from the normal service execution flow (or are new log messages) and in the same time are recognized as cognitive anomalies by our deep network." nbTooltipStatus="basic" status="basic"></nb-icon>
    </h6>
    <nb-card>
      <nb-card-body>
        <div class="col-lg-12 p-0">
          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.semanticCountAds.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No critical anomalies found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>

              <table *ngIf="tableData.semanticCountAds.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 2%"></th>
                  <th [appSort]="tableData.semanticCountAds" class="clickable" data-name="timestamp" data-order="desc"
                      scope="col" style="width: 8%">Timestamp
                  </th>
                  <th [appSort]="tableData.semanticCountAds" class="clickable" data-name="actualLevel" data-order="desc"
                      scope="col" style="width: 7%">Level
                  </th>
                  <th scope="col" style="width: 70%">Log message</th>
                  <th scope="col" style="width: 13%">Ratio
                    <nb-icon icon="info-outline"
                             nbButton
                             nbTooltip="The ratio presents information about the current and expected count number of appereance of particular log type" nbTooltipStatus="basic" status="basic"></nb-icon>
                  </th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.semanticCountAds; let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{row.timestamp}}</td>
                  <td>
                <span [class.error]="row.actualLevel == 'ERROR'"
                      [class.info]="row.actualLevel == 'INFO'"
                      [class.severe]="row.actualLevel == 'SEVERE'"
                      class="mr-2"
                      style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td>
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                  <td>
                    <ngx-charts-bar-horizontal [noBarWhenZero]="true" [results]="[{'name':'Current', 'value':row.rate_now}, {'name':'Previous', 'value':row.smr}]"
                                               [roundEdges]="false" [showDataLabel]="true" [view]="[180,80]"
                                               [yAxis]="false"></ngx-charts-bar-horizontal>
                  </td>
                </tr>
                </tbody>
              </table>
            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
  <div *ngIf="tableData  && tableData.countAds.length > 0" tourAnchor="anchorFlowAnomalies">
    <h6 style="font-weight: 600">Flow anomalies
      <nb-icon icon="info-outline"
               nbButton
               nbTooltip="Flow anomalies are those logs that deviate from the normal flow of the system. For example, consider that log statements A and B are always appearing together in a time interval. If this ratio is broken then we report a flow anomaly. logsight.ai learns system flows, our method needs ~10.000 log messages for this feature to be enabled" nbTooltipStatus="basic" status="basic"></nb-icon>
    </h6>


    <nb-card>

      <nb-card-body>
        <div class="col-lg-12 p-0">
          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.countAds.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No flow anomalies found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>

              <table *ngIf="tableData.countAds.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 2%"></th>
                  <th [appSort]="tableData.countAds" class="clickable" data-name="timestamp" data-order="desc"
                      scope="col" style="width: 8%">Timestamp
                  </th>

                  <th [appSort]="tableData.countAds" class="clickable" data-name="actualLevel" data-order="desc"
                      scope="col" style="width: 7%">Level
                  </th>
                  <th scope="col" style="width: 70%">Log message</th>
                  <th scope="col" style="width: 13%">Ratio
                    <nb-icon icon="info-outline"
                             nbButton
                             nbTooltip="The ratio presents information about the current and expected count number of appereance of particular log type" nbTooltipStatus="basic" status="basic"></nb-icon>
                  </th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.countAds; let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{row.timestamp}}</td>

                  <td>
                    <span [class.error]="row.actualLevel == 'ERROR'"
                          [class.info]="row.actualLevel == 'INFO'"
                          [class.severe]="row.actualLevel == 'SEVERE'"
                          class="mr-2"
                          style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td>
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                  <td>
                    <ngx-charts-bar-horizontal [noBarWhenZero]="true" [results]="[{'name':'Current', 'value':row.rate_now}, {'name':'Previous', 'value':row.smr}]"
                                               [roundEdges]="false" [showDataLabel]="true" [view]="[150,80]"
                                               [yAxis]="false"></ngx-charts-bar-horizontal>
                  </td>
                </tr>
                </tbody>
              </table>
            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
  <div *ngIf="tableData  && tableData.semanticAd.length > 0" tourAnchor="anchorCogAnomalies">
    <h6 style="font-weight: 600">Cognitive anomalies
      <nb-icon icon="info-outline"
               nbButton
               nbTooltip="Cognitive anomalies are log messages that have negative semantic meaning in software systems. The AI system in the background knows how to distinguish normal and anomaly log messages based on learning from millions log messages." nbTooltipStatus="basic" status="basic"></nb-icon>
    </h6>
    <nb-card>
      <nb-card-body>
        <div class="col-lg-12 p-0">

          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.semanticAd.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No cognitive anomalies found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>

              <table *ngIf="tableData.semanticAd.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 2%"></th>
                  <th [appSort]="tableData.semanticAd" class='clickable' data-name="timestamp" data-order="desc"
                      scope="col"
                      style="width: 8%">Timestamp
                  </th>
                  <th [appSort]="tableData.semanticAd" class='clickable' data-name="actualLevel" data-order="desc"
                      scope="col"
                      style="width: 7%">Level
                  </th>
                  <th scope="col" style="width: 83%">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.semanticAd; let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{row.timestamp}}</td>
                  <td>
                <span [class.error]="row.actualLevel == 'ERROR'"
                      [class.info]="row.actualLevel == 'INFO'"
                      [class.severe]="row.actualLevel == 'SEVERE'"
                      class="mr-2"
                      style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td>
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                </tr>
                </tbody>
              </table>

            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>

  <div *ngIf="tableData  && hasError" tourAnchor="anchorCogAnomalies">
    <h6 style="font-weight: 600">Error logs
    </h6>
    <nb-card>
      <nb-card-body>
        <div class="col-lg-12 p-0">

          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.logData.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No cognitive anomalies found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>

              <table *ngIf="tableData.logData.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 2%"></th>
                  <th [appSort]="tableData.logData" class='clickable' data-name="timestamp" data-order="desc"
                      scope="col"
                      style="width: 8%">Timestamp
                  </th>
                  <th [appSort]="tableData.logData" class='clickable' data-name="actualLevel" data-order="desc"
                      scope="col"
                      style="width: 7%">Level
                  </th>
                  <th scope="col" style="width: 83%">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.logData; let i = index">
                  <td
                    *ngIf="row.actualLevel == 'ERROR' || row.actualLevel == 'CRITICAL'  || row.actualLevel == 'SEVERE'">{{i + 1}}</td>
                  <td
                    *ngIf="row.actualLevel == 'ERROR' || row.actualLevel == 'CRITICAL'  || row.actualLevel == 'SEVERE'">{{row.timestamp}}</td>
                  <td
                    *ngIf="row.actualLevel == 'ERROR' || row.actualLevel == 'CRITICAL'  || row.actualLevel == 'SEVERE'">
                <span [class.error]="row.actualLevel == 'ERROR'"
                      [class.info]="row.actualLevel == 'INFO'"
                      [class.severe]="row.actualLevel == 'SEVERE'"
                      class="mr-2"
                      style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td
                    *ngIf="row.actualLevel == 'ERROR' || row.actualLevel == 'CRITICAL'  || row.actualLevel == 'SEVERE'">
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                </tr>
                </tbody>
              </table>

            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>


  <div *ngIf="tableData  && tableData.logData.length > 0">
    <h6 style="font-weight: 600">All log messages
      <nb-icon icon="info-outline"
               nbButton
               nbTooltip="Log messages that correspond to the incident." nbTooltipStatus="basic" status="basic"></nb-icon>
    </h6>
    <nb-card>
      <nb-card-body>
        <div class="col-lg-12 p-0">

          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.logData.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No cognitive anomalies found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>

              <table *ngIf="tableData.logData.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 4%"></th>
                  <th [appSort]="tableData.logData" class='clickable' data-name="timestamp" data-order="desc"
                      scope="col"
                      style="width: 8%">Timestamp
                  </th>
                  <th [appSort]="tableData.logData" class='clickable' data-name="actualLevel" data-order="desc"
                      scope="col"
                      style="width: 7%">Level
                  </th>
                  <th scope="col" style="width: 81%">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.logData; let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{row.timestamp}}</td>
                  <td>
                <span [class.error]="row.actualLevel == 'ERROR'"
                      [class.info]="row.actualLevel == 'INFO'"
                      [class.severe]="row.actualLevel == 'SEVERE'"
                      class="mr-2"
                      style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td>
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                </tr>
                </tbody>
              </table>

            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>

  <div *ngIf="tableData && tableData.newTemplates.length > 0" tourAnchor="anchorNewAnomalies">
    <h6 style="font-weight: 600">New log types
      <nb-icon icon="info-outline"
               nbButton
               nbTooltip='These log types are detected as novel and not seen before. This might happen when there is abnormal system behavior, or simply a new update of the application.' nbTooltipStatus="basic" status="basic"></nb-icon>
    </h6>
    <nb-card>
      <nb-card-body>
        <div class="col-lg-12 p-0">
          <div class="scrollable">
            <ng-scrollbar>
              <table *ngIf="tableData.newTemplates.length == 0"
                     style="text-align: center; justify-content: center; align-items: center; margin-top:50px">
                <p>No new log types found.</p>
                <i class="fas fa-check-circle fa-10x"></i>
              </table>


              <table *ngIf="tableData.newTemplates.length > 0" class="table table-striped table-borderless">
                <thead>
                <tr>
                  <th scope="col" style="width: 2%"></th>
                  <th [appSort]="tableData.newTemplates" class='clickable' data-name="timestamp" data-order="desc"
                      scope="col" style="width: 8%">Timestamp
                  </th>
                  <th [appSort]="tableData.newTemplates" class='clickable' data-name="actualLevel" data-order="desc"
                      scope="col" style="width: 5%">Level
                  </th>
                  <th scope="col" style="width: 80%">Message</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableData.newTemplates; let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{row.timestamp}}</td>
                  <td>
                <span [class.error]="row.actualLevel == 'ERROR'"
                      [class.info]="row.actualLevel == 'INFO'"
                      [class.severe]="row.actualLevel == 'SEVERE'"
                      class="mr-2"
                      style="float: left; color: yellow; font-weight: 600;">{{row.actualLevel}}</span>
                  </td>
                  <td>
                    <app-ad-banner [row]="row"></app-ad-banner>
                  </td>
                </tr>
                </tbody>
              </table>
            </ng-scrollbar>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>


</div>
<ng-template #dateTimePicker>
  <elastic-custom-datepicker (savePredefinedTime)="onSavePredefinedTime($event)"
                             (search)="onDateTimeSearch($event)"></elastic-custom-datepicker>
</ng-template>
